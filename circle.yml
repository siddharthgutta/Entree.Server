machine:
  node:
    version: 5.5.0

dependencies:
  pre:
    - npm install -g npm

test:
  pre:
    - npm run lint
    - grunt lazy-compile
  override:
    - npm run tests

deployment:
  production:
    branch: master
    commands:
      - chmod 400 ./keys/entree.pem
      - ssh ubuntu@ec2-52-38-63-13.us-west-2.compute.amazonaws.com -i ./keys/entree.pem 'bash -s' < ./scripts/deploy_prod.sh
  staging:
    branch: /^(?!master$).*/
    commands:
      - chmod 400 ./keys/entree.pem
      - ssh ubuntu@ec2-52-41-69-134.us-west-2.compute.amazonaws.com -i ./keys/entree.pem 'bash -s' < ./scripts/deploy_staging.sh $CIRCLE_BRANCH
